@page "/"
@using PetWorld.Application.Chat
@inject AskQuestionService AskService

<h1>PetWorld Chat</h1>

<div style="max-width: 900px;">
    <textarea @bind="Question" rows="4" style="width:100%;" placeholder="Zadaj pytanie o produkty..."></textarea>

    <div style="margin-top: 8px;">
        <button @onclick="SendAsync" disabled="@IsBusy">Wy≈õlij</button>
    </div>

    @if (!string.IsNullOrWhiteSpace(Error))
    {
        <p style="color: #b00020; margin-top: 10px;">@Error</p>
    }

    @if (!string.IsNullOrWhiteSpace(Answer))
    {
        <div style="margin-top: 16px; padding: 12px; border: 1px solid #ddd; border-radius: 6px;">
            <div style="font-size: 12px; opacity: 0.7;">Iteracje Writer-Critic: @Iterations</div>
            <pre style="white-space: pre-wrap; margin: 8px 0 0 0;">@Answer</pre>
        </div>
    }
</div>

@code {
    private string Question { get; set; } = "";
    private string Answer { get; set; } = "";
    private int Iterations { get; set; }
    private bool IsBusy { get; set; }
    private string Error { get; set; } = "";

    private async Task SendAsync()
    {
        Error = "";
        Answer = "";
        Iterations = 0;

        if (string.IsNullOrWhiteSpace(Question))
        {
            Error = "Wpisz pytanie.";
            return;
        }

        try
        {
            IsBusy = true;
            var result = await AskService.AskAsync(Question);
            Answer = result.Answer;
            Iterations = result.Iterations;
        }
        catch (Exception ex)
        {
            Error = ex.Message;
        }
        finally
        {
            IsBusy = false;
        }
    }
}
